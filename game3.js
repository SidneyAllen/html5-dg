
/*
 JS WARS 1.0.1
 Copyright (C) 2009  Jonas Wagner

 This program is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.

 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.

 You should have received a copy of the GNU General Public License
 along with this program.  If not, see <http://www.gnu.org/licenses/>.

 NOTE:  The GPL does only apply to the source code (this file).
        Other parts like the graphics are NOT licensed under the GPL!
*/
                                                                                                                                                                                                                                                                                                                                if (typeof (console) == "undefined") {
                                                                                                                                                                                                                                                                                                                                    console = {
                                                                                                                                                                                                                                                                                                                                        log: function () {}
                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                var proto = window.CanvasRenderingContext2D.prototype;
                                                                                                                                                                                                                                                                                                                                if (proto.mozMeasureText && !proto.measureText) {
                                                                                                                                                                                                                                                                                                                                    proto.__defineSetter__("font", function (a) {
                                                                                                                                                                                                                                                                                                                                        this.mozTextStyle = a
                                                                                                                                                                                                                                                                                                                                    });
                                                                                                                                                                                                                                                                                                                                    proto.__defineGetter__("font", function () {
                                                                                                                                                                                                                                                                                                                                        return this.mozTextStyle
                                                                                                                                                                                                                                                                                                                                    })
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                if (proto.mozMeasureText && !proto.measureText) {
                                                                                                                                                                                                                                                                                                                                    console.log("wrapping measureText");
                                                                                                                                                                                                                                                                                                                                    proto.measureText = function (a) {
                                                                                                                                                                                                                                                                                                                                        return {
                                                                                                                                                                                                                                                                                                                                            width: this.mozMeasureText(a)
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                if (proto.mozPathText && !proto.strokeText) {
                                                                                                                                                                                                                                                                                                                                    console.log("wrapping strokeText");
                                                                                                                                                                                                                                                                                                                                    proto.strokeText = function (b, a, c) {
                                                                                                                                                                                                                                                                                                                                        this.translate(a, c);
                                                                                                                                                                                                                                                                                                                                        this.mozPathText(b);
                                                                                                                                                                                                                                                                                                                                        this.stroke();
                                                                                                                                                                                                                                                                                                                                        this.translate(-a, -c)
                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                if (proto.mozDrawText && !proto.fillText) {
                                                                                                                                                                                                                                                                                                                                    console.log("wrapping fillText");
                                                                                                                                                                                                                                                                                                                                    proto.fillText = function (b, a, c) {
                                                                                                                                                                                                                                                                                                                                        this.translate(a, c);
                                                                                                                                                                                                                                                                                                                                        this.mozDrawText(b);
                                                                                                                                                                                                                                                                                                                                        this.translate(-a, -c)
                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                function Canvas(b, c) {
                                                                                                                                                                                                                                                                                                                                    var a = document.createElement("canvas");
                                                                                                                                                                                                                                                                                                                                    a.setAttribute("width", b);
                                                                                                                                                                                                                                                                                                                                    a.setAttribute("height", c);
                                                                                                                                                                                                                                                                                                                                    return a
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                function fillTextMultiline(b, e, a, f, d) {
                                                                                                                                                                                                                                                                                                                                    if (!$.isArray(e)) {
                                                                                                                                                                                                                                                                                                                                        e = e.split("\n")
                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                    for (var c = 0; c < e.length; c++) {
                                                                                                                                                                                                                                                                                                                                        b.fillText(e[c], a, f);
                                                                                                                                                                                                                                                                                                                                        f += d
                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                function V2(d, c) {
                                                                                                                                                                                                                                                                                                                                    this.a = d;
                                                                                                                                                                                                                                                                                                                                    this.b = c
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                v2 = function (d, c) {
                                                                                                                                                                                                                                                                                                                                    return new V2(d, c)
                                                                                                                                                                                                                                                                                                                                }; V2.prototype.mul = function (a) {
                                                                                                                                                                                                                                                                                                                                    return v2(this.a * a, this.b * a)
                                                                                                                                                                                                                                                                                                                                }; V2.prototype.magnitude = function () {
                                                                                                                                                                                                                                                                                                                                    return Math.sqrt(this.a * this.a + this.b * this.b)
                                                                                                                                                                                                                                                                                                                                }; V2.prototype.normalize = function () {
                                                                                                                                                                                                                                                                                                                                    return this.mul(1 / this.magnitude())
                                                                                                                                                                                                                                                                                                                                };

                                                                                                                                                                                                                                                                                                                                function max(d, c) {
                                                                                                                                                                                                                                                                                                                                    return (d > c) ? d : c
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                function min(d, c) {
                                                                                                                                                                                                                                                                                                                                    return (d < c) ? d : c
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                function rect_collision(d, c) {
                                                                                                                                                                                                                                                                                                                                    return !(d.y + d.h < c.y || d.y > c.y + c.h || d.x + d.w < c.x || d.x > c.x + c.w)
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                function do_collosion(g, f) {
                                                                                                                                                                                                                                                                                                                                    if (!$.isArray(g)) {
                                                                                                                                                                                                                                                                                                                                        g = [g]
                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                    if (!$.isArray(f)) {
                                                                                                                                                                                                                                                                                                                                        f = [f]
                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                    for (var k = 0; k < g.length; k++) {
                                                                                                                                                                                                                                                                                                                                        for (var h = 0; h < f.length; h++) {
                                                                                                                                                                                                                                                                                                                                            if (rect_collision(g[k], f[h])) {
                                                                                                                                                                                                                                                                                                                                                var n = g[k];
                                                                                                                                                                                                                                                                                                                                                var m = f[h];
                                                                                                                                                                                                                                                                                                                                                var l = min(n.hp / m.dmg, m.hp / n.dmg);
                                                                                                                                                                                                                                                                                                                                                n.hp -= m.dmg * l;
                                                                                                                                                                                                                                                                                                                                                m.hp -= n.dmg * l
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                function noise(a) {
                                                                                                                                                                                                                                                                                                                                    return ((((a + 21541352) ^ 1546733486) * (a ^ 28308090) * (a ^ 82014727)) % 1000000) / 1000000
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                function noise2(a, b) {
                                                                                                                                                                                                                                                                                                                                    return noise((a * 23) ^ (b * 13))
                                                                                                                                                                                                                                                                                                                                }
																																																																																
																																																																																								function offerMissile() {
    $('#offer').fadeIn(500);																																																																																		
																																																																																			}
																																																																																			
																																																																																			function releaseMissile() {

	//RESTART GAME
	jswars.game.paused = false;
	jswars.game.missile = true;
	
}	
																																																																																			function cancelMissile() {

	//RESTART GAME
	jswars.game.paused = false;
	
}			

function verifyMissile() {

    xconnection.verify('888888','123',
	function() {
		console.log('Missile  Verified');
		jswars.game.paused = false;
		jswars.game.missile = true;
		
	},
	function() {
		//console.log(xconnection.getVerifyData());
		console.log('Missile NOT Verified');
		offerMissile();
	});
	
	
}																																																																						
                                
                                                                                                                                                                                                                                                                                                                                function smoothnoise(b, d) {
                                                                                                                                                                                                                                                                                                                                    var c = Math.floor(b);
                                                                                                                                                                                                                                                                                                                                    var a = (noise(c) * 2 + noise(c - 1) + noise(c + 1)) / 4;
                                                                                                                                                                                                                                                                                                                                    return a
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                function smoothnoise2d(b, e) {
                                                                                                                                                                                                                                                                                                                                    var c = Math.floor(b);
                                                                                                                                                                                                                                                                                                                                    var d = Math.floor(e);
                                                                                                                                                                                                                                                                                                                                    var a = noise2(c - 1, d - 1);
                                                                                                                                                                                                                                                                                                                                    a += noise2(c, d - 1);
                                                                                                                                                                                                                                                                                                                                    a += noise2(c + 1, d - 1);
                                                                                                                                                                                                                                                                                                                                    a += noise2(c - 1, d);
                                                                                                                                                                                                                                                                                                                                    a += noise2(c, d) * 2;
                                                                                                                                                                                                                                                                                                                                    a += noise2(c + 1, d);
                                                                                                                                                                                                                                                                                                                                    a += noise2(c - 1, d + 1);
                                                                                                                                                                                                                                                                                                                                    a += noise2(c, d + 1);
                                                                                                                                                                                                                                                                                                                                    a += noise2(c + 1, d + 1);
                                                                                                                                                                                                                                                                                                                                    return a / 10
                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                var keyname = {
                                                                                                                                                                                                                                                                                                                                    32: "SPACE",
                                                                                                                                                                                                                                                                                                                                    13: "ENTER",
                                                                                                                                                                                                                                                                                                                                    9: "TAB",
                                                                                                                                                                                                                                                                                                                                    8: "BACKSPACE",
                                                                                                                                                                                                                                                                                                                                    16: "SHIFT",
                                                                                                                                                                                                                                                                                                                                    17: "CTRL",
                                                                                                                                                                                                                                                                                                                                    18: "ALT",
                                                                                                                                                                                                                                                                                                                                    20: "CAPS_LOCK",
                                                                                                                                                                                                                                                                                                                                    144: "NUM_LOCK",
                                                                                                                                                                                                                                                                                                                                    145: "SCROLL_LOCK",
                                                                                                                                                                                                                                                                                                                                    37: "LEFT",
                                                                                                                                                                                                                                                                                                                                    38: "UP",
                                                                                                                                                                                                                                                                                                                                    39: "RIGHT",
                                                                                                                                                                                                                                                                                                                                    40: "DOWN",
                                                                                                                                                                                                                                                                                                                                    33: "PAGE_UP",
                                                                                                                                                                                                                                                                                                                                    34: "PAGE_DOWN",
                                                                                                                                                                                                                                                                                                                                    36: "HOME",
                                                                                                                                                                                                                                                                                                                                    35: "END",
                                                                                                                                                                                                                                                                                                                                    45: "INSERT",
                                                                                                                                                                                                                                                                                                                                    46: "DELETE",
                                                                                                                                                                                                                                                                                                                                    27: "ESCAPE",
                                                                                                                                                                                                                                                                                                                                    19: "PAUSE",
                                                                                                                                                                                                                                                                                                                                    222: "'"
                                                                                                                                                                                                                                                                                                                                }; jswars = {}; with(jswars) {
                                                                                                                                                                                                                                                                                                                                    jswars.levels = [];
                                                                                                                                                                                                                                                                                                                                    jswars.Timer = function () {
                                                                                                                                                                                                                                                                                                                                        var a = this;
                                                                                                                                                                                                                                                                                                                                        a.ontick = function () {};
                                                                                                                                                                                                                                                                                                                                        a.last = new Date().getTime() / 1000;
                                                                                                                                                                                                                                                                                                                                        a.tick = function () {
                                                                                                                                                                                                                                                                                                                                            var b = new Date().getTime() / 1000;
                                                                                                                                                                                                                                                                                                                                            a.ontick(b - a.last);
                                                                                                                                                                                                                                                                                                                                            a.last = b
                                                                                                                                                                                                                                                                                                                                        };
                                                                                                                                                                                                                                                                                                                                        a.set_rate = function (b) {
                                                                                                                                                                                                                                                                                                                                            a.rate = b;
                                                                                                                                                                                                                                                                                                                                            if (a.interval) {
                                                                                                                                                                                                                                                                                                                                                clearInterval(a.interval)
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            a.interval = setInterval(a.tick, 1000 / b)
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.KeyTracker = function () {
                                                                                                                                                                                                                                                                                                                                        var a = this;
                                                                                                                                                                                                                                                                                                                                        a.focus = true;
                                                                                                                                                                                                                                                                                                                                        a.reset = function () {
                                                                                                                                                                                                                                                                                                                                            var d;
                                                                                                                                                                                                                                                                                                                                            for (d in keyname) {
                                                                                                                                                                                                                                                                                                                                                a[keyname[d]] = false
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                        };
                                                                                                                                                                                                                                                                                                                                        var b = $(document).keydown(function (d) {
                                                                                                                                                                                                                                                                                                                                            a[keyname[d.keyCode]] = true;
                                                                                                                                                                                                                                                                                                                                            return !a.focus
                                                                                                                                                                                                                                                                                                                                        });
                                                                                                                                                                                                                                                                                                                                        var c = $(document).keyup(function (d) {
                                                                                                                                                                                                                                                                                                                                            a[keyname[d.keyCode]] = false;
                                                                                                                                                                                                                                                                                                                                            return !a.focus
                                                                                                                                                                                                                                                                                                                                        })
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.ParallaxScroller = function (b, a) {
                                                                                                                                                                                                                                                                                                                                        this.layers = b;
                                                                                                                                                                                                                                                                                                                                        this.width = a
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.ParallaxScroller.prototype.draw = function (b, f) {
                                                                                                                                                                                                                                                                                                                                        var a, c, e;
                                                                                                                                                                                                                                                                                                                                        for (var d = 0; d < this.layers.length; d++) {
                                                                                                                                                                                                                                                                                                                                            e = this.layers[d];
                                                                                                                                                                                                                                                                                                                                            c = e[2];
                                                                                                                                                                                                                                                                                                                                            a = Math.round(e[0] + e[1] * f % this.width);
                                                                                                                                                                                                                                                                                                                                            b.drawImage(c, a, 0);
                                                                                                                                                                                                                                                                                                                                            b.drawImage(c, (a + c.width), 0)
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.ResourceLoader = function () {
                                                                                                                                                                                                                                                                                                                                        this.total = 0;
                                                                                                                                                                                                                                                                                                                                        this.loaded = 0
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.ResourceLoader.prototype.load = function (d, c, b) {
                                                                                                                                                                                                                                                                                                                                        var a = this;
                                                                                                                                                                                                                                                                                                                                        var e = document.createElement(d);
                                                                                                                                                                                                                                                                                                                                        a[c] = e;
                                                                                                                                                                                                                                                                                                                                        a.total++;
                                                                                                                                                                                                                                                                                                                                        $(e).one("error", function () {
                                                                                                                                                                                                                                                                                                                                            console.log("error", b);
                                                                                                                                                                                                                                                                                                                                            a.loaded++
                                                                                                                                                                                                                                                                                                                                        });
                                                                                                                                                                                                                                                                                                                                        if (d == "video" || d == "audio") {
                                                                                                                                                                                                                                                                                                                                            $(e).one("canplaythrough", function () {
                                                                                                                                                                                                                                                                                                                                                console.log("loaded", b);
                                                                                                                                                                                                                                                                                                                                                a.loaded++
                                                                                                                                                                                                                                                                                                                                            });
                                                                                                                                                                                                                                                                                                                                            e.setAttribute("autobuffer", "autobuffer");
                                                                                                                                                                                                                                                                                                                                            e.setAttribute("src", b);
                                                                                                                                                                                                                                                                                                                                            e.load()
                                                                                                                                                                                                                                                                                                                                        } else {
                                                                                                                                                                                                                                                                                                                                            e.setAttribute("src", b);
                                                                                                                                                                                                                                                                                                                                            $(e).one("load", function () {
                                                                                                                                                                                                                                                                                                                                                console.log("loaded", b);
                                                                                                                                                                                                                                                                                                                                                a.loaded++
                                                                                                                                                                                                                                                                                                                                            })
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.main = function () {
                                                                                                                                                                                                                                                                                                                                        jswars.html5av = document.createElement("video").load != undefined;
                                                                                                                                                                                                                                                                                                                                        jswars.no_video = navigator.productSub == "20090423";
                                                                                                                                                                                                                                                                                                                                        jswars.data = new ResourceLoader();
                                                                                                                                                                                                                                                                                                                                        data.load("img", "player_ship", "gfx/player_ship.png");
                                                                                                                                                                                                                                                                                                                                        data.player_ship.frames = 10;
                                                                                                                                                                                                                                                                                                                                        data.load("img", "rocket", "gfx/rocket%20animated.png");
                                                                                                                                                                                                                                                                                                                                        data.rocket.frames = 1;
                                                                                                                                                                                                                                                                                                                                        data.load("img", "nuke", "gfx/nuke.png");
                                                                                                                                                                                                                                                                                                                                        data.nuke.frames = 10;
                                                                                                                                                                                                                                                                                                                                        data.load("img", "asteroid", "gfx/asteroid.png");
                                                                                                                                                                                                                                                                                                                                        data.load("img", "mine", "gfx/mine.png");
                                                                                                                                                                                                                                                                                                                                        data.load("img", "background_menu", "gfx/background_menu.jpg");
                                                                                                                                                                                                                                                                                                                                        data.load("img", "background0", "gfx/background0.jpg");
                                                                                                                                                                                                                                                                                                                                        data.load("img", "background1", "gfx/background1.png");
                                                                                                                                                                                                                                                                                                                                        data.load("img", "background2", "gfx/background2.png");
                                                                                                                                                                                                                                                                                                                                        data.load("img", "shot", "gfx/shot.png");
                                                                                                                                                                                                                                                                                                                                        data.load("img", "eye", "gfx/eye.png");
                                                                                                                                                                                                                                                                                                                                        data.load("img", "eye_explosion", "gfx/eye_explosion.png");
                                                                                                                                                                                                                                                                                                                                        data.eye_explosion.frames = 4;
                                                                                                                                                                                                                                                                                                                                        data.load("img", "mine_blink", "gfx/mine_blink.png");
                                                                                                                                                                                                                                                                                                                                        data.mine_blink.frames = 2;
                                                                                                                                                                                                                                                                                                                                        data.load("img", "explosion0", "gfx/explosion.png");
                                                                                                                                                                                                                                                                                                                                        data.explosion0.frames = 17;
                                                                                                                                                                                                                                                                                                                                        data.load("img", "explosion1", "gfx/explosion2.png");
                                                                                                                                                                                                                                                                                                                                        data.explosion1.frames = 17;
                                                                                                                                                                                                                                                                                                                                        data.load("img", "explosion2", "gfx/explosion3.png");
                                                                                                                                                                                                                                                                                                                                        data.explosion2.frames = 17;
                                                                                                                                                                                                                                                                                                                                        data.explosion = [data.explosion1, data.explosion2, data.explosion0];
                                                                                                                                                                                                                                                                                                                                        data.load("img", "missile_powerup", "gfx/missile_powerup.png");
                                                                                                                                                                                                                                                                                                                                        data.missile_powerup.frames = 19;
                                                                                                                                                                                                                                                                                                                                        data.load("img", "radioactive_powerup", "gfx/radioactive_powerup.png");
                                                                                                                                                                                                                                                                                                                                        data.radioactive_powerup.frames = 19;
                                                                                                                                                                                                                                                                                                                                        data.load("img", "skull", "gfx/skull.png");
                                                                                                                                                                                                                                                                                                                                        data.skull.frames = 30;
                                                                                                                                                                                                                                                                                                                                        data.load("img", "fireball", "gfx/fireball.png");
                                                                                                                                                                                                                                                                                                                                        if (html5av) {
                                                                                                                                                                                                                                                                                                                                            data.load("audio", "explosion_sound", "data/explosion.ogg");
                                                                                                                                                                                                                                                                                                                                            data.load("audio", "music", "data/countdown-behind.ogg");
                                                                                                                                                                                                                                                                                                                                            data.music.volume = 0;
                                                                                                                                                                                                                                                                                                                                            data.music.play()
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        jswars.screen = $("#screen");
                                                                                                                                                                                                                                                                                                                                        jswars.width = screen.width();
                                                                                                                                                                                                                                                                                                                                        jswars.height = screen.height();
                                                                                                                                                                                                                                                                                                                                        jswars.ctx = screen[0].getContext("2d");
                                                                                                                                                                                                                                                                                                                                        jswars.keys = new KeyTracker();
                                                                                                                                                                                                                                                                                                                                        screen.click(function () {
                                                                                                                                                                                                                                                                                                                                            keys.focus = true
                                                                                                                                                                                                                                                                                                                                        });
                                                                                                                                                                                                                                                                                                                                        $("input").add("textarea").click(function () {
                                                                                                                                                                                                                                                                                                                                            keys.focus = false
                                                                                                                                                                                                                                                                                                                                        });
                                                                                                                                                                                                                                                                                                                                        jswars.timer = new Timer();
                                                                                                                                                                                                                                                                                                                                        jswars.intro = new Intro();
                                                                                                                                                                                                                                                                                                                                        jswars.highscores = JSON.parse($.cookie("jswars.highscores") || "[]")
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.Timeline = function (a) {
                                                                                                                                                                                                                                                                                                                                        this.data = a || [];
                                                                                                                                                                                                                                                                                                                                        this.dirty = true
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.Timeline.prototype.tick = function (a) {
                                                                                                                                                                                                                                                                                                                                        if (this.dirty) {
                                                                                                                                                                                                                                                                                                                                            this.data.sort(function (d, c) {
                                                                                                                                                                                                                                                                                                                                                return d[0] - c[0]
                                                                                                                                                                                                                                                                                                                                            });
                                                                                                                                                                                                                                                                                                                                            this.data.reverse();
                                                                                                                                                                                                                                                                                                                                            this.dirty = false
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        while (this.data.length && this.data[this.data.length - 1][0] <= a) {
                                                                                                                                                                                                                                                                                                                                            this.data.pop()[1]()
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.Timeline.prototype.add = function (a, b) {
                                                                                                                                                                                                                                                                                                                                        this.push([a, b]);
                                                                                                                                                                                                                                                                                                                                        this.dirty = true
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.Credits = function () {
                                                                                                                                                                                                                                                                                                                                        var c = 20;
                                                                                                                                                                                                                                                                                                                                        timer.set_rate(30);
                                                                                                                                                                                                                                                                                                                                        var d = ["Software Development: Jonas Wagner", "3D Artwork: Jonas Wagner", "2D Artwork: Jonas Wagner", "Sound Effects: Jonas Wagner", "Music: Countdown - Behind <http://www.countdown.fr.fm>"];
                                                                                                                                                                                                                                                                                                                                        var b = 0;
                                                                                                                                                                                                                                                                                                                                        timer.ontick = function (i) {
                                                                                                                                                                                                                                                                                                                                            b += i;
                                                                                                                                                                                                                                                                                                                                            ctx.drawImage(data.background0, 0, 0);
                                                                                                                                                                                                                                                                                                                                            ctx.fillStyle = "gold";
                                                                                                                                                                                                                                                                                                                                            var g = height - min(b, 10) * 20;
                                                                                                                                                                                                                                                                                                                                            var f = 0;
                                                                                                                                                                                                                                                                                                                                            var e;
                                                                                                                                                                                                                                                                                                                                            ctx.font = c + "px sans-serif";
                                                                                                                                                                                                                                                                                                                                            fillTextMultiline(ctx, d, 50, g, c * 1.5);
                                                                                                                                                                                                                                                                                                                                            ctx.fillStyle = "gold";
                                                                                                                                                                                                                                                                                                                                            ctx.font = "20px Impact";
                                                                                                                                                                                                                                                                                                                                            ctx.fillText("Credits", (width - ctx.measureText("Credits").width) / 2, 40)
                                                                                                                                                                                                                                                                                                                                        };
                                                                                                                                                                                                                                                                                                                                        var a = $(document).one("keydown.credits", function (e) {
                                                                                                                                                                                                                                                                                                                                            jswars.menu.enter()
                                                                                                                                                                                                                                                                                                                                        })
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.Intro = function () {
                                                                                                                                                                                                                                                                                                                                        var k = this;
                                                                                                                                                                                                                                                                                                                                        var a = 100;
                                                                                                                                                                                                                                                                                                                                        var h = 3;
                                                                                                                                                                                                                                                                                                                                        var g = 1000;
                                                                                                                                                                                                                                                                                                                                        var j = 32;
                                                                                                                                                                                                                                                                                                                                        var b = [];
                                                                                                                                                                                                                                                                                                                                        var d = 0;

                                                                                                                                                                                                                                                                                                                                        function f() {
                                                                                                                                                                                                                                                                                                                                            return [(Math.random() - 0.5) * width * Math.sqrt(a) / 2, (Math.random() - 0.5) * height * Math.sqrt(a) / 2, a + d]
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        for (var c = 0; c < g; c++) {
                                                                                                                                                                                                                                                                                                                                            b.push([(Math.random() - 0.5) * width * Math.sqrt(a) / 2, (Math.random() - 0.5) * height * Math.sqrt(a) / 2, Math.random() * a + d])
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        function e() {
                                                                                                                                                                                                                                                                                                                                            if (data.total == data.loaded && d > 3) {
                                                                                                                                                                                                                                                                                                                                                ctx.restore();
                                                                                                                                                                                                                                                                                                                                                jswars.menu = new jswars.Menu()
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            ctx.fillStyle = "rgba(0,0,0,0.5)";
                                                                                                                                                                                                                                                                                                                                            ctx.fillRect(0, 0, width, height);
                                                                                                                                                                                                                                                                                                                                            ctx.fillStyle = "white";
                                                                                                                                                                                                                                                                                                                                            for (var n = 0; n < b.length; n++) {
                                                                                                                                                                                                                                                                                                                                                if (b[n][2] <= d) {
                                                                                                                                                                                                                                                                                                                                                    b[n] = f()
                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                var q = Math.sqrt(b[n][2] - d);
                                                                                                                                                                                                                                                                                                                                                var l = (b[n][0] / q) + width / 2;
                                                                                                                                                                                                                                                                                                                                                var r = (b[n][1] / q) + height / 2;
                                                                                                                                                                                                                                                                                                                                                if (l < 0 || l > width || r < 0 || r > height) {
                                                                                                                                                                                                                                                                                                                                                    b[n] = f();
                                                                                                                                                                                                                                                                                                                                                    continue
                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                ctx.beginPath();
                                                                                                                                                                                                                                                                                                                                                ctx.arc(l, r, h / q, 0, Math.PI * 2, true);
                                                                                                                                                                                                                                                                                                                                                ctx.closePath();
                                                                                                                                                                                                                                                                                                                                                ctx.fill()
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            ctx.fillStyle = "gold";
                                                                                                                                                                                                                                                                                                                                            ctx.font = j + "px Impact";
                                                                                                                                                                                                                                                                                                                                            var m = ctx.measureText("JS-TYPE").width;
                                                                                                                                                                                                                                                                                                                                            ctx.fillText("JS WARS", (width - m) / 2, (height - j) / 2);
                                                                                                                                                                                                                                                                                                                                            ctx.font = j / 2 + "px Impact";
                                                                                                                                                                                                                                                                                                                                            if (data.total > data.loaded) {
                                                                                                                                                                                                                                                                                                                                                var p = "Loading... please be patient";
                                                                                                                                                                                                                                                                                                                                                var m = ctx.measureText(p).width;
                                                                                                                                                                                                                                                                                                                                                ctx.fillText(p, (width - m) / 2, (height - j / 2) / 2 + j)
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            var o = 128;
                                                                                                                                                                                                                                                                                                                                            ctx.strokeStyle = "red";
                                                                                                                                                                                                                                                                                                                                            ctx.strokeRect((width - o) / 2, height / 2 + j, o, 25);
                                                                                                                                                                                                                                                                                                                                            ctx.fillRect((width - o) / 2, height / 2 + j, o / data.total * data.loaded, 25)
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        timer.ontick = function (i) {
                                                                                                                                                                                                                                                                                                                                            d += i;
                                                                                                                                                                                                                                                                                                                                            e()
                                                                                                                                                                                                                                                                                                                                        };
                                                                                                                                                                                                                                                                                                                                        ctx.save();
                                                                                                                                                                                                                                                                                                                                        timer.set_rate(15)
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.Menu = function () {
                                                                                                                                                                                                                                                                                                                                        var c = this;
                                                                                                                                                                                                                                                                                                                                        var e = 18;
                                                                                                                                                                                                                                                                                                                                        var b = [
                                                                                                                                                                                                                                                                                                                                            ["Start Game", function () {
                                                                                                                                                                                                                                                                                                                                                c.exit();
                                                                                                                                                                                                                                                                                                                                                jswars.game = new Game(levels[0])
                                                                                                                                                                                                                                                                                                                                            }],
                                                                                                                                                                                                                                                                                                                                            ["Highscores", function () {
                                                                                                                                                                                                                                                                                                                                                c.exit();
                                                                                                                                                                                                                                                                                                                                                new Highscores()
                                                                                                                                                                                                                                                                                                                                            }],
                                                                                                                                                                                                                                                                                                                                            ["Credits", function () {
                                                                                                                                                                                                                                                                                                                                                c.exit();
                                                                                                                                                                                                                                                                                                                                                new Credits()
                                                                                                                                                                                                                                                                                                                                            }]
                                                                                                                                                                                                                                                                                                                                        ];
                                                                                                                                                                                                                                                                                                                                        var d = 0;
                                                                                                                                                                                                                                                                                                                                        ctx.save();

                                                                                                                                                                                                                                                                                                                                        function a() {
                                                                                                                                                                                                                                                                                                                                            ctx.fillStyle = "black";
                                                                                                                                                                                                                                                                                                                                            ctx.fillRect(0, 0, width, height);
                                                                                                                                                                                                                                                                                                                                            ctx.font = e + "px Impact";
                                                                                                                                                                                                                                                                                                                                            ctx.drawImage(data.background_menu, 0, 0, width, height);
                                                                                                                                                                                                                                                                                                                                            for (var g = 0; g < b.length; g++) {
                                                                                                                                                                                                                                                                                                                                                ctx.fillStyle = (g == d) ? "red" : "gold";
                                                                                                                                                                                                                                                                                                                                                var h = b[g][0];
                                                                                                                                                                                                                                                                                                                                                var f = ctx.measureText(h).width;
                                                                                                                                                                                                                                                                                                                                                ctx.fillText(h, (width - f) / 2, 200 + g * e * 1.5)
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        this.enter = function () {
                                                                                                                                                                                                                                                                                                                                            timer.ontick = a;
                                                                                                                                                                                                                                                                                                                                            timer.set_rate(10);
                                                                                                                                                                                                                                                                                                                                            $(document).bind("keydown.menu", function (f) {
                                                                                                                                                                                                                                                                                                                                                if (!keys.focus) {
                                                                                                                                                                                                                                                                                                                                                    return
                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                if (f.keyCode == 40) {
                                                                                                                                                                                                                                                                                                                                                    d++;
                                                                                                                                                                                                                                                                                                                                                    d %= b.length
                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                if (f.keyCode == 38) {
                                                                                                                                                                                                                                                                                                                                                    d--;
                                                                                                                                                                                                                                                                                                                                                    if (d < 0) {
                                                                                                                                                                                                                                                                                                                                                        d = b.length - 1
                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                if (f.keyCode == 32 || f.keyCode == 13) {
                                                                                                                                                                                                                                                                                                                                                    b[d][1]()
                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                            })
                                                                                                                                                                                                                                                                                                                                        };
                                                                                                                                                                                                                                                                                                                                        this.enter();
                                                                                                                                                                                                                                                                                                                                        this.exit = function () {
                                                                                                                                                                                                                                                                                                                                            $(document).unbind("keydown.menu")
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.Highscores = function (a) {
                                                                                                                                                                                                                                                                                                                                        var i = this;
                                                                                                                                                                                                                                                                                                                                        if (a && highscores.length < 10 || a > highscores[highscores.length]) {
                                                                                                                                                                                                                                                                                                                                            jswars.highscores.push([a, prompt("Gameover - enter your name")]);
                                                                                                                                                                                                                                                                                                                                            jswars.highscores.sort(function (k, j) {
                                                                                                                                                                                                                                                                                                                                                return j[0] - k[0]
                                                                                                                                                                                                                                                                                                                                            });
                                                                                                                                                                                                                                                                                                                                            if (jswars.highscores.length > 10) {
                                                                                                                                                                                                                                                                                                                                                jswars.highscores.pop()
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            $.cookie("jswars.highscores", JSON.stringify(jswars.highscores), {
                                                                                                                                                                                                                                                                                                                                                expires: 365 * 10
                                                                                                                                                                                                                                                                                                                                            })
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        var g = 18;
                                                                                                                                                                                                                                                                                                                                        var e = 640;
                                                                                                                                                                                                                                                                                                                                        var c = 480;
                                                                                                                                                                                                                                                                                                                                        var d = Canvas(e, c);
                                                                                                                                                                                                                                                                                                                                        var b = d.getContext("2d");
                                                                                                                                                                                                                                                                                                                                        b.fillRect(0, 0, e, c);
                                                                                                                                                                                                                                                                                                                                        ctx.save();
                                                                                                                                                                                                                                                                                                                                        var h = 0;

                                                                                                                                                                                                                                                                                                                                        function f(n) {
                                                                                                                                                                                                                                                                                                                                            h += n;
                                                                                                                                                                                                                                                                                                                                            b.fillStyle = "rgba(100, 150, 250, 0.8);";
                                                                                                                                                                                                                                                                                                                                            for (var l = 0; l < e / 4; l++) {
                                                                                                                                                                                                                                                                                                                                                var k = (smoothnoise(l / 6, h * 2) * 2 + smoothnoise2d(l / 4, h * 6) * 2 + smoothnoise2d(l, h * 8)) / 5;
                                                                                                                                                                                                                                                                                                                                                b.fillRect(l * 4, c / 4 + k * c / 4, 2, 2)
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            b.drawImage(d, Math.round(-e / 100 + (Math.random())), 2, e + e / 50, c + 5);
                                                                                                                                                                                                                                                                                                                                            ctx.drawImage(d, 0, 0, width, height);
                                                                                                                                                                                                                                                                                                                                            ctx.fillStyle = "gold";
                                                                                                                                                                                                                                                                                                                                            ctx.font = g + "px Impact";
                                                                                                                                                                                                                                                                                                                                            var o = (a) ? ("Game over - Score: " + a) : "Highscores";
                                                                                                                                                                                                                                                                                                                                            var j = ctx.measureText(o).width;
                                                                                                                                                                                                                                                                                                                                            ctx.fillText(o, (width - j) / 2, 100);
                                                                                                                                                                                                                                                                                                                                            ctx.font = "12px sans-serif";
                                                                                                                                                                                                                                                                                                                                            var m = [];
                                                                                                                                                                                                                                                                                                                                            for (var l = 0; l < highscores.length; l++) {
                                                                                                                                                                                                                                                                                                                                                m.push(highscores[l][0] + " - " + highscores[l][1])
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            fillTextMultiline(ctx, m, 100, 120 + g, 12 * 1.5)
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        timer.ontick = f;
                                                                                                                                                                                                                                                                                                                                        timer.set_rate(20);
                                                                                                                                                                                                                                                                                                                                        $(document).one("keydown.gameover", function (j) {
                                                                                                                                                                                                                                                                                                                                            jswars.menu.enter()
                                                                                                                                                                                                                                                                                                                                        })
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.Game = function (f) {
                                                                                                                                                                                                                                                                                                                                        var c = this;
                                                                                                                                                                                                                                                                                                                                        jswars.keys.reset();
                                                                                                                                                                                                                                                                                                                                        c.enemies = new SpriteGroup();
                                                                                                                                                                                                                                                                                                                                        c.friends = new SpriteGroup();
                                                                                                                                                                                                                                                                                                                                        c.neutral = new SpriteGroup();
                                                                                                                                                                                                                                                                                                                                        c.graphics = new SpriteGroup();
                                                                                                                                                                                                                                                                                                                                        c.player = new Player(c, data.player_ship);
                                                                                                                                                                                                                                                                                                                                        c.player.x = 20;
                                                                                                                                                                                                                                                                                                                                        c.player.y = (height - c.player.h) / 2;
                                                                                                                                                                                                                                                                                                                                        c.friends.push(c.player);
                                                                                                                                                                                                                                                                                                                                        c.background = new ParallaxScroller([], width);
                                                                                                                                                                                                                                                                                                                                        c.level = new f(c);
                                                                                                                                                                                                                                                                                                                                        c.t = 0;
                                                                                                                                                                                                                                                                                                                                        c.score = 0;
                                                                                                                                                                                                                                                                                                                                        c.paused = false;
																																																																																		                               c.missile = false;
                                                                                                                                                                                                                                                                                                                                        ctx.save();
                                                                                                                                                                                                                                                                                                                                        if (html5av && data.music) {
                                                                                                                                                                                                                                                                                                                                            data.music.volume = 1;
                                                                                                                                                                                                                                                                                                                                            data.music.play();
                                                                                                                                                                                                                                                                                                                                            try {
                                                                                                                                                                                                                                                                                                                                                data.music.currentTime = 0
                                                                                                                                                                                                                                                                                                                                            } catch (g) {
                                                                                                                                                                                                                                                                                                                                                console.log("could not set current time on music")
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        function d(h, e) {
                                                                                                                                                                                                                                                                                                                                            return !(h.y + h.h < e.y || h.y > e.y + e.h || h.x + h.w < e.x || h.x > e.x + e.w)
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        function a() {
                                                                                                                                                                                                                                                                                                                                            c.background.draw(ctx, c.t);
                                                                                                                                                                                                                                                                                                                                            c.player.draw(ctx);
                                                                                                                                                                                                                                                                                                                                            c.enemies.draw(ctx);
                                                                                                                                                                                                                                                                                                                                            c.graphics.draw(ctx);
                                                                                                                                                                                                                                                                                                                                            c.friends.draw(ctx);
                                                                                                                                                                                                                                                                                                                                            c.neutral.draw(ctx);
                                                                                                                                                                                                                                                                                                                                            ctx.fillStyle = "gold";
                                                                                                                                                                                                                                                                                                                                            ctx.font = "12px Impact";
                                                                                                                                                                                                                                                                                                                                            ctx.fillText("Score " + c.score + " Health " + Math.round(c.player.hp), 10, 15);
                                                                                                                                                                                                                                                                                                                                            ctx.fillText(c.player.secondary_weapon.name + ": " + c.player.secondary_weapon.ammo, 10, 30)
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        timer.ontick = function (m) {
                                                                                                                                                                                                                                                                                                                                            if (c.paused) {
                                                                                                                                                                                                                                                                                                                                                return
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            c.t += m;
                                                                                                                                                                                                                                                                                                                                            c.level.tick(m);
                                                                                                                                                                                                                                                                                                                                            var l = c.player;
                                                                                                                                                                                                                                                                                                                                            if (keys.LEFT) {
                                                                                                                                                                                                                                                                                                                                                l.x -= l.speed * m
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            if (keys.RIGHT) {
                                                                                                                                                                                                                                                                                                                                                l.x += l.speed * m
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            if (l.x < 0) {
                                                                                                                                                                                                                                                                                                                                                l.x = 0
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            if (l.x + l.w > width) {
                                                                                                                                                                                                                                                                                                                                                l.x = width - l.w
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            if (keys.UP) {
                                                                                                                                                                                                                                                                                                                                                l.y -= l.speed * m
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            if (keys.DOWN) {
                                                                                                                                                                                                                                                                                                                                                l.y += l.speed * m
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            if (l.y < 0) {
                                                                                                                                                                                                                                                                                                                                                l.y = 0
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            if (l.y + l.h > height) {
                                                                                                                                                                                                                                                                                                                                                l.y = height - l.h
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            if (keys.SPACE) {
                                                                                                                                                                                                                                                                                                                                                l.primary_weapon.fire()
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            if (keys.CTRL) {
                                    
									
									
								       if(c.missile)
									   {                                                                                                                                                                                               l.secondary_weapon.fire()
									   }
																																																																																			                                    }
                                                                                                                                                                                                                                                                                                                                            var k, h;
                                                                                                                                                                                                                                                                                                                                            var e = c.enemies;
                                                                                                                                                                                                                                                                                                                                            c.player.tick(m);
                                                                                                                                                                                                                                                                                                                                            c.enemies.tick(m);
                                                                                                                                                                                                                                                                                                                                            c.friends.tick(m);
                                                                                                                                                                                                                                                                                                                                            c.graphics.tick(m);
                                                                                                                                                                                                                                                                                                                                            c.neutral.tick(m);
                                                                                                                                                                                                                                                                                                                                            c.enemies.cleanup();
                                                                                                                                                                                                                                                                                                                                            c.friends.cleanup();
                                                                                                                                                                                                                                                                                                                                            c.graphics.cleanup();
                                                                                                                                                                                                                                                                                                                                            c.neutral.cleanup();
                                                                                                                                                                                                                                                                                                                                            do_collosion(c.enemies.sprites, c.friends.sprites);
                                                                                                                                                                                                                                                                                                                                            do_collosion(c.player, c.enemies.sprites);
                                                                                                                                                                                                                                                                                                                                            do_collosion(c.player, c.neutral.sprites);
                                                                                                                                                                                                                                                                                                                                            do_collosion(c.neutral.sprites, c.friends.sprites);
                                                                                                                                                                                                                                                                                                                                            do_collosion(c.neutral.sprites, c.enemies.sprites);
                                                                                                                                                                                                                                                                                                                                            a();
                                                                                                                                                                                                                                                                                                                                            if (l.hp <= 0 || l.dead) {
                                                                                                                                                                                                                                                                                                                                                if (html5av) {
                                                                                                                                                                                                                                                                                                                                                    data.music.pause()
                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                new Highscores(c.score);
                                                                                                                                                                                                                                                                                                                                                $(document).unbind("keydown.game")
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                        };
                                                                                                                                                                                                                                                                                                                                        var b = $(document).bind("keydown.game", function (e) {
                                                                                                                                                                                        
	 							if (e.keyCode == 17 ) {
									
									if(!c.missile)
									{
										
																			                                                                                                                                                                                            c.paused = !c.paused;
                                                                                                                                                                                                                                                                                                                                                    if (c.paused) {
                                                                                                                                                                                                                                                                                                                                                      ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
                                                                                                                                                                                                                                                                                                                                                      ctx.fillRect(0, 0, width, height);
                                                                                                                                                                                                                                                                                                                                                      ctx.fillStyle = "gold";
                                                                                                                                                                                                                                                                                                                                                      ctx.strokeStyle = "black";
                                                                                                                                                                                                                                                                                                                                                      ctx.font = "32px Impact";
                                                                                                                                                                                                                                                                                                                                                      var h = ctx.measureText("Verifying").width;
                                                                                                                                                                                                                                                                                                                                                      ctx.fillText("Verifying", (width - h) / 2, (height - 32) / 2);
                                                                                                                                                                                                                                                                                                                                                      ctx.strokeText("Verifying", (width - h) / 2, (height - 32) / 2)
																																																																																					  										verifyMissile()
											
									   }
									 }
                                                                                                                                                                                                                                                                                                                                            }																																													
																																														
																																														
																																														
																																														
																																														
																																														
																																														                                                                                                                                                    if (e.keyCode == 27 || e.keyCode == 19) {
                                                                                                                                                                                                                                                                                                                                                c.paused = !c.paused;
                                                                                                                                                                                                                                                                                                                                                if (c.paused) {
                                                                                                                                                                                                                                                                                                                                                    ctx.fillStyle = "rgba(0, 0, 0, 0.5)";
                                                                                                                                                                                                                                                                                                                                                    ctx.fillRect(0, 0, width, height);
                                                                                                                                                                                                                                                                                                                                                    ctx.fillStyle = "gold";
                                                                                                                                                                                                                                                                                                                                                    ctx.strokeStyle = "black";
                                                                                                                                                                                                                                                                                                                                                    ctx.font = "32px Impact";
                                                                                                                                                                                                                                                                                                                                                    var h = ctx.measureText("Paused").width;
                                                                                                                                                                                                                                                                                                                                                    ctx.fillText("Paused", (width - h) / 2, (height - 32) / 2);
                                                                                                                                                                                                                                                                                                                                                    ctx.strokeText("Paused", (width - h) / 2, (height - 32) / 2)
                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                        });
																																																																																		
								
								                                                                                                                                                                                                                                                                                                        timer.set_rate(30)
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.Sprite = function (a) {
                                                                                                                                                                                                                                                                                                                                        this.img = a;
                                                                                                                                                                                                                                                                                                                                        this.x = 0;
                                                                                                                                                                                                                                                                                                                                        this.y = 0;
                                                                                                                                                                                                                                                                                                                                        this.w = a.width;
                                                                                                                                                                                                                                                                                                                                        this.h = a.height;
                                                                                                                                                                                                                                                                                                                                        this.dead = false;
                                                                                                                                                                                                                                                                                                                                        this.hp = 10;
                                                                                                                                                                                                                                                                                                                                        this.dmg = 10
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    Sprite.prototype.draw = function (a) {
                                                                                                                                                                                                                                                                                                                                        a.drawImage(this.img, Math.floor(this.x), Math.floor(this.y), this.img.width, this.img.height)
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    Sprite.prototype.tick = function (a) {};
                                                                                                                                                                                                                                                                                                                                    Sprite.prototype.die = function () {
                                                                                                                                                                                                                                                                                                                                        this.dead = true
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    SpriteGroup = function () {
                                                                                                                                                                                                                                                                                                                                        this.sprites = []
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    SpriteGroup.prototype = {};
                                                                                                                                                                                                                                                                                                                                    SpriteGroup.prototype.push = function (a) {
                                                                                                                                                                                                                                                                                                                                        this.sprites.push(a)
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    SpriteGroup.prototype.tick = function (c) {
                                                                                                                                                                                                                                                                                                                                        for (var b = 0; b < this.sprites.length; b++) {
                                                                                                                                                                                                                                                                                                                                            this.sprites[b].tick(c)
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        for (var b = 0; b < this.sprites.length; b++) {
                                                                                                                                                                                                                                                                                                                                            var a = this.sprites[b];
                                                                                                                                                                                                                                                                                                                                            if (a.hp <= 0 || a.x + a.w < 0 || a.x > width) {
                                                                                                                                                                                                                                                                                                                                                a.die()
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    SpriteGroup.prototype.draw = function (a) {
                                                                                                                                                                                                                                                                                                                                        for (var b = 0; b < this.sprites.length; b++) {
                                                                                                                                                                                                                                                                                                                                            this.sprites[b].draw(a)
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    SpriteGroup.prototype.cleanup = function () {
                                                                                                                                                                                                                                                                                                                                        var b = this.sprites;
                                                                                                                                                                                                                                                                                                                                        this.sprites = [];
                                                                                                                                                                                                                                                                                                                                        for (var a = 0; a < b.length; a++) {
                                                                                                                                                                                                                                                                                                                                            if (!b[a].dead) {
                                                                                                                                                                                                                                                                                                                                                this.sprites.push(b[a])
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    SpriteGroup.prototype.splash_damage = function (b, a, g) {
                                                                                                                                                                                                                                                                                                                                        for (var f = 0; f < this.sprites.length; f++) {
                                                                                                                                                                                                                                                                                                                                            var e = this.sprites[f];
                                                                                                                                                                                                                                                                                                                                            var d = a - e.x;
                                                                                                                                                                                                                                                                                                                                            var c = g - e.y;
                                                                                                                                                                                                                                                                                                                                            e.hp -= b / max(50, Math.sqrt(d * d + c * c))
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    SpriteGroup.prototype.area_damage = function (b, a, h, g) {
                                                                                                                                                                                                                                                                                                                                        for (var f = 0; f < this.sprites.length; f++) {
                                                                                                                                                                                                                                                                                                                                            var e = this.sprites[f];
                                                                                                                                                                                                                                                                                                                                            var d = a - e.x;
                                                                                                                                                                                                                                                                                                                                            var c = h - e.y;
                                                                                                                                                                                                                                                                                                                                            if (Math.sqrt(d * d + c * c) < g) {
                                                                                                                                                                                                                                                                                                                                                e.hp -= b
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.Animation = function (a, b) {
                                                                                                                                                                                                                                                                                                                                        Sprite.call(this, a);
                                                                                                                                                                                                                                                                                                                                        this.frames = a.frames;
                                                                                                                                                                                                                                                                                                                                        this.framerate = b;
                                                                                                                                                                                                                                                                                                                                        this.w = a.width / this.frames;
                                                                                                                                                                                                                                                                                                                                        this.t = 0
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    $.extend(Animation.prototype, Sprite.prototype);
                                                                                                                                                                                                                                                                                                                                    Animation.prototype.tick = function (a) {
                                                                                                                                                                                                                                                                                                                                        this.t += a
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    Animation.prototype.draw = function (c) {
                                                                                                                                                                                                                                                                                                                                        var d = this.framerate;
                                                                                                                                                                                                                                                                                                                                        var b = this.img.width / this.frames;
                                                                                                                                                                                                                                                                                                                                        var a = Math.floor((this.t % (d * this.frames)) / d) * b;
                                                                                                                                                                                                                                                                                                                                        c.drawImage(this.img, a, 0, b, this.img.height, Math.floor(this.x), Math.floor(this.y), b, this.img.height)
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.EyeExplosion = function (a, b) {
                                                                                                                                                                                                                                                                                                                                        Animation.call(this, data.eye_explosion, 0.1);
                                                                                                                                                                                                                                                                                                                                        this.x = a;
                                                                                                                                                                                                                                                                                                                                        this.y = b
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    $.extend(EyeExplosion.prototype, Animation.prototype);
                                                                                                                                                                                                                                                                                                                                    EyeExplosion.prototype.tick = function (a) {
                                                                                                                                                                                                                                                                                                                                        this.t += a;
                                                                                                                                                                                                                                                                                                                                        if (this.t > this.frames * this.framerate) {
                                                                                                                                                                                                                                                                                                                                            this.die()
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.Explosion = function (a, b) {
                                                                                                                                                                                                                                                                                                                                        Animation.call(this, data.explosion[Math.floor(Math.random() * data.explosion.length)], 0.05);
                                                                                                                                                                                                                                                                                                                                        if (html5av) {
                                                                                                                                                                                                                                                                                                                                            data.explosion_sound.cloneNode(true).play()
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        this.x = a - this.w / 2;
                                                                                                                                                                                                                                                                                                                                        this.y = b - this.h / 2;
                                                                                                                                                                                                                                                                                                                                        this.hp = 10000;
                                                                                                                                                                                                                                                                                                                                        this.dmg = 50
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    $.extend(Explosion.prototype, Animation.prototype);
                                                                                                                                                                                                                                                                                                                                    Explosion.prototype.tick = function (a) {
                                                                                                                                                                                                                                                                                                                                        this.t += a;
                                                                                                                                                                                                                                                                                                                                        if (this.t > this.frames * this.framerate) {
                                                                                                                                                                                                                                                                                                                                            this.die()
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.Player = function (c, b) {
                                                                                                                                                                                                                                                                                                                                        Animation.call(this, b, 0.1);
                                                                                                                                                                                                                                                                                                                                        this.speed = 500;
                                                                                                                                                                                                                                                                                                                                        this.hp = 100;
                                                                                                                                                                                                                                                                                                                                        this.w -= 25;
                                                                                                                                                                                                                                                                                                                                        var a = this;
                                                                                                                                                                                                                                                                                                                                        this.primary_weapon = new Weapon("Blaster", function () {
                                                                                                                                                                                                                                                                                                                                            return new Shot(a.x + a.w, a.y + a.h / 3, 1000, 60)
                                                                                                                                                                                                                                                                                                                                        }, 0.2, c.friends);
                                                                                                                                                                                                                                                                                                                                        this.secondary_weapon = new Weapon("Missiles", function () {
                                                                                                                                                                                                                                                                                                                                            return new Missile(a.x + a.w, a.y + a.h / 3, 300)
                                                                                                                                                                                                                                                                                                                                        }, 1, c.friends, 5)
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    $.extend(Player.prototype, Animation.prototype);
                                                                                                                                                                                                                                                                                                                                    Player.prototype.draw = function (c) {
                                                                                                                                                                                                                                                                                                                                        if (this.secondary_weapon.name == "Nuke" && this.secondary_weapon.ammo > 0) {
                                                                                                                                                                                                                                                                                                                                            var b = data.nuke.width / data.nuke.frames;
                                                                                                                                                                                                                                                                                                                                            c.drawImage(data.nuke, 0, 0, b, data.nuke.height, Math.floor(this.x + 10), Math.floor(this.y + 16), b, data.nuke.height)
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        var d = this.framerate;
                                                                                                                                                                                                                                                                                                                                        var b = this.img.width / this.frames;
                                                                                                                                                                                                                                                                                                                                        var a = Math.floor((this.t % (d * this.frames)) / d) * b;
                                                                                                                                                                                                                                                                                                                                        c.drawImage(this.img, a, 0, b, this.img.height, Math.floor(this.x) - 25, Math.floor(this.y), b, this.img.height)
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    Player.prototype.tick = function (a) {
                                                                                                                                                                                                                                                                                                                                        this.hp = min(this.hp + a, 100);
                                                                                                                                                                                                                                                                                                                                        this.t += a
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.Weapon = function (b, a, c, e, d) {
                                                                                                                                                                                                                                                                                                                                        this.name = b;
                                                                                                                                                                                                                                                                                                                                        this.projectile = a;
                                                                                                                                                                                                                                                                                                                                        this.rate = c;
                                                                                                                                                                                                                                                                                                                                        this.group = e;
                                                                                                                                                                                                                                                                                                                                        this.ammo = d || -1;
                                                                                                                                                                                                                                                                                                                                        this.t = 0
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.Weapon.prototype.fire = function () {
                                                                                                                                                                                                                                                                                                                                        if (game.t - this.t > this.rate && this.ammo != 0) {
                                                                                                                                                                                                                                                                                                                                            this.t = game.t;
                                                                                                                                                                                                                                                                                                                                            this.group.push(this.projectile());
                                                                                                                                                                                                                                                                                                                                            this.ammo--
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.Projectile = function (a, d, c, b) {
                                                                                                                                                                                                                                                                                                                                        Sprite.call(this, b);
                                                                                                                                                                                                                                                                                                                                        this.x = a;
                                                                                                                                                                                                                                                                                                                                        this.y = d;
                                                                                                                                                                                                                                                                                                                                        this.vx = c
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    $.extend(Projectile.prototype, Sprite.prototype);
                                                                                                                                                                                                                                                                                                                                    Projectile.prototype.tick = function (a) {
                                                                                                                                                                                                                                                                                                                                        this.x += this.vx * a;
                                                                                                                                                                                                                                                                                                                                        if (this.x > width || this.x + this.w < 0) {
                                                                                                                                                                                                                                                                                                                                            this.dead = true
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.Missile = function (a, d, c, b) {
                                                                                                                                                                                                                                                                                                                                        Projectile.call(this, a, d, c, data.rocket);
                                                                                                                                                                                                                                                                                                                                        Animation.call(this, data.rocket, 0.05);
                                                                                                                                                                                                                                                                                                                                        this.x = a;
                                                                                                                                                                                                                                                                                                                                        this.y = d;
                                                                                                                                                                                                                                                                                                                                        this.hp = 1;
                                                                                                                                                                                                                                                                                                                                        this.dmg = 100
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    $.extend(Missile.prototype, Projectile.prototype, Animation.prototype);
                                                                                                                                                                                                                                                                                                                                    Missile.prototype.tick = function (a) {
                                                                                                                                                                                                                                                                                                                                        Projectile.prototype.tick.call(this, a);
                                                                                                                                                                                                                                                                                                                                        Animation.prototype.tick.call(this, a)
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    Missile.prototype.die = function () {
                                                                                                                                                                                                                                                                                                                                        game.enemies.area_damage(100, this.x + this.w / 2, this.y + this.h / 2, 100);
                                                                                                                                                                                                                                                                                                                                        game.graphics.push(new Explosion(this.x + this.w / 2, this.y + this.h / 2));
                                                                                                                                                                                                                                                                                                                                        this.dead = true
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.Nuke = function (a, c, b) {
                                                                                                                                                                                                                                                                                                                                        Projectile.call(this, a, c, b, data.nuke);
                                                                                                                                                                                                                                                                                                                                        Animation.call(this, data.nuke, 0.05);
                                                                                                                                                                                                                                                                                                                                        this.x = a;
                                                                                                                                                                                                                                                                                                                                        this.y = c;
                                                                                                                                                                                                                                                                                                                                        this.hp = 1;
                                                                                                                                                                                                                                                                                                                                        this.dmg = 100
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    $.extend(Nuke.prototype, Projectile.prototype, Animation.prototype);
                                                                                                                                                                                                                                                                                                                                    Nuke.prototype.tick = function (a) {
                                                                                                                                                                                                                                                                                                                                        Projectile.prototype.tick.call(this, a);
                                                                                                                                                                                                                                                                                                                                        Animation.prototype.tick.call(this, a)
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    Nuke.prototype.die = function () {
                                                                                                                                                                                                                                                                                                                                        game.enemies.splash_damage(8000, this.x, this.y);
                                                                                                                                                                                                                                                                                                                                        new NukeEffect(this.x, this.y);
                                                                                                                                                                                                                                                                                                                                        this.dead = true
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.Shot = function (b, e, d, a, c) {
                                                                                                                                                                                                                                                                                                                                        Projectile.call(this, b, e, d, c || data.shot);
                                                                                                                                                                                                                                                                                                                                        this.dmg = a;
                                                                                                                                                                                                                                                                                                                                        this.hp = 1
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    Shot.prototype = Projectile.prototype;
                                                                                                                                                                                                                                                                                                                                    jswars.RadioactivePowerup = function (a, d, c, b) {
                                                                                                                                                                                                                                                                                                                                        Animation.call(this, data.radioactive_powerup, 0.05);
                                                                                                                                                                                                                                                                                                                                        this.x = a;
                                                                                                                                                                                                                                                                                                                                        this.y = d;
                                                                                                                                                                                                                                                                                                                                        this.vx = c;
                                                                                                                                                                                                                                                                                                                                        this.vy = b;
                                                                                                                                                                                                                                                                                                                                        this.hp = 10
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    $.extend(RadioactivePowerup.prototype, Animation.prototype);
                                                                                                                                                                                                                                                                                                                                    RadioactivePowerup.prototype.tick = function (a) {
                                                                                                                                                                                                                                                                                                                                        Animation.prototype.tick.call(this, a);
                                                                                                                                                                                                                                                                                                                                        this.x += this.vx * a;
                                                                                                                                                                                                                                                                                                                                        this.y += this.vy * a
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    RadioactivePowerup.prototype.die = function () {
                                                                                                                                                                                                                                                                                                                                        if (this.hp != 10) {
                                                                                                                                                                                                                                                                                                                                            console.log("activated radioactive powerup");
                                                                                                                                                                                                                                                                                                                                            game.player.secondary_weapon = new Weapon("Nuke", function () {
                                                                                                                                                                                                                                                                                                                                                return new Nuke(game.player.x, game.player.y + 16, 100)
                                                                                                                                                                                                                                                                                                                                            }, 1, game.friends, 1)
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        this.dead = true
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.MissilePowerup = function (a, d, c, b) {
                                                                                                                                                                                                                                                                                                                                        Animation.call(this, data.missile_powerup, 0.05);
                                                                                                                                                                                                                                                                                                                                        this.x = a;
                                                                                                                                                                                                                                                                                                                                        this.y = d;
                                                                                                                                                                                                                                                                                                                                        this.vx = c;
                                                                                                                                                                                                                                                                                                                                        this.vy = b;
                                                                                                                                                                                                                                                                                                                                        this.hp = 10
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    $.extend(MissilePowerup.prototype, Animation.prototype);
                                                                                                                                                                                                                                                                                                                                    MissilePowerup.prototype.tick = function (a) {
                                                                                                                                                                                                                                                                                                                                        Animation.prototype.tick.call(this, a);
                                                                                                                                                                                                                                                                                                                                        this.x += this.vx * a;
                                                                                                                                                                                                                                                                                                                                        this.y += this.vy * a
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    MissilePowerup.prototype.die = function () {
                                                                                                                                                                                                                                                                                                                                        if (this.hp != 10) {
                                                                                                                                                                                                                                                                                                                                            console.log("activated missile powerup");
                                                                                                                                                                                                                                                                                                                                            game.player.secondary_weapon = new Weapon("Missiles", function () {
                                                                                                                                                                                                                                                                                                                                                return new Missile(game.player.x + game.player.w, game.player.y + game.player.h / 3, 300)
                                                                                                                                                                                                                                                                                                                                            }, 1, game.friends, 5)
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        this.dead = true
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.Mine = function (a, d, c, b) {
                                                                                                                                                                                                                                                                                                                                        Sprite.call(this, data.mine);
                                                                                                                                                                                                                                                                                                                                        this.x = a;
                                                                                                                                                                                                                                                                                                                                        this.y = d;
                                                                                                                                                                                                                                                                                                                                        this.vx = c;
                                                                                                                                                                                                                                                                                                                                        this.vy = b;
                                                                                                                                                                                                                                                                                                                                        this.hp = 20
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    $.extend(Mine.prototype, Sprite.prototype);
                                                                                                                                                                                                                                                                                                                                    Mine.prototype.tick = function (a) {
                                                                                                                                                                                                                                                                                                                                        this.x += this.vx * a;
                                                                                                                                                                                                                                                                                                                                        this.y += this.vy * a;
                                                                                                                                                                                                                                                                                                                                        this.y += Math.sin(game.t) * a * 20
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    Mine.prototype.die = function () {
                                                                                                                                                                                                                                                                                                                                        game.graphics.push(new Explosion(this.x + this.w / 2, this.y + this.h / 2));
                                                                                                                                                                                                                                                                                                                                        game.score += 10;
                                                                                                                                                                                                                                                                                                                                        this.dead = true;
                                                                                                                                                                                                                                                                                                                                        this.hp = 25
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.TrackingMine = function (a, c, b) {
                                                                                                                                                                                                                                                                                                                                        Animation.call(this, data.mine_blink, 1);
                                                                                                                                                                                                                                                                                                                                        this.x = a;
                                                                                                                                                                                                                                                                                                                                        this.y = c;
                                                                                                                                                                                                                                                                                                                                        this.v = b
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    $.extend(TrackingMine.prototype, Animation.prototype);
                                                                                                                                                                                                                                                                                                                                    TrackingMine.prototype.tick = function (b) {
                                                                                                                                                                                                                                                                                                                                        if (this.x < game.player.x) {
                                                                                                                                                                                                                                                                                                                                            this.t = 1;
                                                                                                                                                                                                                                                                                                                                            var a = v2(this.x - game.player.x, this.y - game.player.y).normalize().mul(this.v * b);
                                                                                                                                                                                                                                                                                                                                            this.x += a.a;
                                                                                                                                                                                                                                                                                                                                            this.y += a.b
                                                                                                                                                                                                                                                                                                                                        } else {
                                                                                                                                                                                                                                                                                                                                            this.x += this.v * b;
                                                                                                                                                                                                                                                                                                                                            this.t = 0
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    TrackingMine.prototype.die = function () {
                                                                                                                                                                                                                                                                                                                                        game.graphics.push(new Explosion(this.x + this.w / 2, this.y + this.h / 2));
                                                                                                                                                                                                                                                                                                                                        game.enemies.area_damage(40, this.x + this.w / 2, this.y + this.h / 2, 150);
                                                                                                                                                                                                                                                                                                                                        game.friends.area_damage(40, this.x + this.w / 2, this.y + this.h / 2, 150);
                                                                                                                                                                                                                                                                                                                                        game.score += 15;
                                                                                                                                                                                                                                                                                                                                        this.dead = true
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.SkullBoss = function (a, b) {
                                                                                                                                                                                                                                                                                                                                        Animation.call(this, data.skull, 0.05);
                                                                                                                                                                                                                                                                                                                                        this.x = a;
                                                                                                                                                                                                                                                                                                                                        this.y = b;
                                                                                                                                                                                                                                                                                                                                        this.hp = 500;
                                                                                                                                                                                                                                                                                                                                        this.lastshot = 0;
                                                                                                                                                                                                                                                                                                                                        this.v = 0
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    $.extend(SkullBoss.prototype, Animation.prototype);
                                                                                                                                                                                                                                                                                                                                    SkullBoss.prototype.tick = function (a) {
                                                                                                                                                                                                                                                                                                                                        this.t += a;
                                                                                                                                                                                                                                                                                                                                        this.v = max(-1, min(1, (game.player.y - this.y - 125) / 200)) * 200;
                                                                                                                                                                                                                                                                                                                                        this.y += this.v * a;
                                                                                                                                                                                                                                                                                                                                        if (this.t % 1.5 > 1 && this.t - this.lastshot > 0.5) {
                                                                                                                                                                                                                                                                                                                                            this.lastshot = this.t;
                                                                                                                                                                                                                                                                                                                                            game.enemies.push(new Shot(this.x, this.y + 125, -300, 600, data.fireball))
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    SkullBoss.prototype.die = function () {
                                                                                                                                                                                                                                                                                                                                        new NukeEffect(this.x, this.y);
                                                                                                                                                                                                                                                                                                                                        game.score += 1000;
                                                                                                                                                                                                                                                                                                                                        this.dead = true
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.Eye = function (a, d, c, b) {
                                                                                                                                                                                                                                                                                                                                        Sprite.call(this, data.eye);
                                                                                                                                                                                                                                                                                                                                        this.x = a;
                                                                                                                                                                                                                                                                                                                                        this.y = d;
                                                                                                                                                                                                                                                                                                                                        this.vx = c;
                                                                                                                                                                                                                                                                                                                                        this.vy = b;
                                                                                                                                                                                                                                                                                                                                        this.hp = 25
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    $.extend(Eye.prototype, Sprite.prototype);
                                                                                                                                                                                                                                                                                                                                    Eye.prototype.tick = function (a) {
                                                                                                                                                                                                                                                                                                                                        this.x += this.vx * a;
                                                                                                                                                                                                                                                                                                                                        this.y += this.vy * a;
                                                                                                                                                                                                                                                                                                                                        if (Math.random() > 0.99) {
                                                                                                                                                                                                                                                                                                                                            game.enemies.push(new Shot(this.x, this.y + this.h / 2, -500, 200))
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    Eye.prototype.die = function () {
                                                                                                                                                                                                                                                                                                                                        game.graphics.push(new EyeExplosion(this.x, this.y));
                                                                                                                                                                                                                                                                                                                                        console.log("dead");
                                                                                                                                                                                                                                                                                                                                        game.score += 30;
                                                                                                                                                                                                                                                                                                                                        this.dead = true
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    jswars.NukeEffect = function (c, b) {
                                                                                                                                                                                                                                                                                                                                        var s = 8;
                                                                                                                                                                                                                                                                                                                                        var g = width / s;
                                                                                                                                                                                                                                                                                                                                        var p = height / s;
                                                                                                                                                                                                                                                                                                                                        var m = new Canvas(g, p);
                                                                                                                                                                                                                                                                                                                                        var q = new Canvas(width, height);
                                                                                                                                                                                                                                                                                                                                        var e = m.getContext("2d");
                                                                                                                                                                                                                                                                                                                                        var a = q.getContext("2d");
                                                                                                                                                                                                                                                                                                                                        a.drawImage(screen[0], 0, 0);
                                                                                                                                                                                                                                                                                                                                        e.drawImage(screen[0], 0, 0, g, p);
                                                                                                                                                                                                                                                                                                                                        ctx.drawImage(m, 0, 0, width, height);
                                                                                                                                                                                                                                                                                                                                        var j = width * height * 4;
                                                                                                                                                                                                                                                                                                                                        var f = ctx.getImageData(0, 0, width, height);
                                                                                                                                                                                                                                                                                                                                        if (f == null) {
                                                                                                                                                                                                                                                                                                                                            console.log("bdata is null, probably webkit");
                                                                                                                                                                                                                                                                                                                                            return
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        var k = 0;
                                                                                                                                                                                                                                                                                                                                        var l = timer.ontick;
                                                                                                                                                                                                                                                                                                                                        var n = timer.rate;
                                                                                                                                                                                                                                                                                                                                        var d = 100;
                                                                                                                                                                                                                                                                                                                                        var o = Math.PI * 2 / 200;
                                                                                                                                                                                                                                                                                                                                        var i = -2;
                                                                                                                                                                                                                                                                                                                                        var r = e.getImageData(0, 0, g, p);
                                                                                                                                                                                                                                                                                                                                        timer.ontick = function (t) {
                                                                                                                                                                                                                                                                                                                                            k += t;
                                                                                                                                                                                                                                                                                                                                            for (var D = 0; D < g; D++) {
                                                                                                                                                                                                                                                                                                                                                for (var C = 0; C < p; C++) {
                                                                                                                                                                                                                                                                                                                                                    var v = (C * g + D) * 4;
                                                                                                                                                                                                                                                                                                                                                    var B = D * s;
                                                                                                                                                                                                                                                                                                                                                    var A = C * s;
                                                                                                                                                                                                                                                                                                                                                    var E = c - B;
                                                                                                                                                                                                                                                                                                                                                    var w = b - A;
                                                                                                                                                                                                                                                                                                                                                    var z = Math.sqrt(E * E + w * w);
                                                                                                                                                                                                                                                                                                                                                    var h = Math.sin(z * o + k * i) * (d / (1 + (z / 100) * (z / 100)) / k);
                                                                                                                                                                                                                                                                                                                                                    B = Math.round(B + h * (E / z));
                                                                                                                                                                                                                                                                                                                                                    A = Math.round(A + h * (w / z));
                                                                                                                                                                                                                                                                                                                                                    var u = (A * width + B) * 4;
                                                                                                                                                                                                                                                                                                                                                    if (u > j || u < 1) {
                                                                                                                                                                                                                                                                                                                                                        r[v + 3] = 0
                                                                                                                                                                                                                                                                                                                                                    } else {
                                                                                                                                                                                                                                                                                                                                                        r.data[v] = min(255, f.data[u] * 2);
                                                                                                                                                                                                                                                                                                                                                        r.data[v + 1] = min(255, f.data[u + 1] * 2);
                                                                                                                                                                                                                                                                                                                                                        r.data[v + 2] = min(255, f.data[u + 2] * 2);
                                                                                                                                                                                                                                                                                                                                                        r.data[v + 3] = min(255, 15 * Math.abs(h))
                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            e.putImageData(r, 0, 0);
                                                                                                                                                                                                                                                                                                                                            ctx.drawImage(q, 0, 0);
                                                                                                                                                                                                                                                                                                                                            ctx.drawImage(m, 0, 0, width, height);
                                                                                                                                                                                                                                                                                                                                            console.log("drawn");
                                                                                                                                                                                                                                                                                                                                            if (k > 1.5) {
                                                                                                                                                                                                                                                                                                                                                timer.ontick = l;
                                                                                                                                                                                                                                                                                                                                                timer.set_rate(n)
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    };
                                                                                                                                                                                                                                                                                                                                    levels.push(function (c) {
                                                                                                                                                                                                                                                                                                                                        var b = this;
                                                                                                                                                                                                                                                                                                                                        var d = new SkullBoss(jswars.width - data.skull.width / data.skull.frames - 10, jswars.height / 2);

                                                                                                                                                                                                                                                                                                                                        function g() {
                                                                                                                                                                                                                                                                                                                                            var h = new([Eye, TrackingMine][Math.round(Math.random() * 1)])(jswars.width, Math.random() * (height - data.mine.height), -30 - b.t, Math.random() * 20 - 10);
                                                                                                                                                                                                                                                                                                                                            c.enemies.push(h)
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        function a() {
                                                                                                                                                                                                                                                                                                                                            if (Math.random() > 0.5) {
                                                                                                                                                                                                                                                                                                                                                c.enemies.push(new RadioactivePowerup(jswars.width, Math.random() * height, -250, 0))
                                                                                                                                                                                                                                                                                                                                            } else {
                                                                                                                                                                                                                                                                                                                                                c.enemies.push(new MissilePowerup(jswars.width, Math.random() * height, -250, 0))
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        b.name = "New Easy Level";
                                                                                                                                                                                                                                                                                                                                        var f = [];
                                                                                                                                                                                                                                                                                                                                        for (var e = 0; e < 1000; e++) {
                                                                                                                                                                                                                                                                                                                                            f.push([e, g]);
                                                                                                                                                                                                                                                                                                                                            if (e % 30 == 0) {
                                                                                                                                                                                                                                                                                                                                                f.push([e, a])
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        f.push([150, function () {
                                                                                                                                                                                                                                                                                                                                            c.enemies.push(d)
                                                                                                                                                                                                                                                                                                                                        }]);
                                                                                                                                                                                                                                                                                                                                        b.timeline = new Timeline(f);
                                                                                                                                                                                                                                                                                                                                        b.t = 0;
                                                                                                                                                                                                                                                                                                                                        c.background.layers = [
                                                                                                                                                                                                                                                                                                                                            [0, 0, data.background0],
                                                                                                                                                                                                                                                                                                                                            [0, -3, data.background1],
                                                                                                                                                                                                                                                                                                                                            [0, -20, data.background2]
                                                                                                                                                                                                                                                                                                                                        ];
                                                                                                                                                                                                                                                                                                                                        b.tick = function (h) {
                                                                                                                                                                                                                                                                                                                                            b.t += h;
                                                                                                                                                                                                                                                                                                                                            c.player.dead |= d.dead;
                                                                                                                                                                                                                                                                                                                                            b.timeline.tick(b.t)
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    });
                                                                                                                                                                                                                                                                                                                                    $(function () {
                                                                                                                                                                                                                                                                                                                                        main()
                                                                                                                                                                                                                                                                                                                                    })
                                                                                                                                                                                                                                                                                                                                }
/*
    http://www.JSON.org/json2.js
    2009-04-16

    Public Domain.

    NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.
*/
                                                                                                                                                                                                                                                                                                                                if (!this.JSON) {
                                                                                                                                                                                                                                                                                                                                    JSON = {}
                                                                                                                                                                                                                                                                                                                                }(function () {
                                                                                                                                                                                                                                                                                                                                    function f(n) {
                                                                                                                                                                                                                                                                                                                                        return n < 10 ? "0" + n : n
                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                    if (typeof Date.prototype.toJSON !== "function") {
                                                                                                                                                                                                                                                                                                                                        Date.prototype.toJSON = function (key) {
                                                                                                                                                                                                                                                                                                                                            return this.getUTCFullYear() + "-" + f(this.getUTCMonth() + 1) + "-" + f(this.getUTCDate()) + "T" + f(this.getUTCHours()) + ":" + f(this.getUTCMinutes()) + ":" + f(this.getUTCSeconds()) + "Z"
                                                                                                                                                                                                                                                                                                                                        };
                                                                                                                                                                                                                                                                                                                                        String.prototype.toJSON = Number.prototype.toJSON = Boolean.prototype.toJSON = function (key) {
                                                                                                                                                                                                                                                                                                                                            return this.valueOf()
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                    var cx = /[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
                                                                                                                                                                                                                                                                                                                                        escapable = /[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
                                                                                                                                                                                                                                                                                                                                        gap, indent, meta = {
                                                                                                                                                                                                                                                                                                                                            "\b": "\\b",
                                                                                                                                                                                                                                                                                                                                            "\t": "\\t",
                                                                                                                                                                                                                                                                                                                                            "\n": "\\n",
                                                                                                                                                                                                                                                                                                                                            "\f": "\\f",
                                                                                                                                                                                                                                                                                                                                            "\r": "\\r",
                                                                                                                                                                                                                                                                                                                                            '"': '\\"',
                                                                                                                                                                                                                                                                                                                                            "\\": "\\\\"
                                                                                                                                                                                                                                                                                                                                        },
                                                                                                                                                                                                                                                                                                                                        rep;

                                                                                                                                                                                                                                                                                                                                    function quote(string) {
                                                                                                                                                                                                                                                                                                                                        escapable.lastIndex = 0;
                                                                                                                                                                                                                                                                                                                                        return escapable.test(string) ? '"' + string.replace(escapable, function (a) {
                                                                                                                                                                                                                                                                                                                                            var c = meta[a];
                                                                                                                                                                                                                                                                                                                                            return typeof c === "string" ? c : "\\u" + ("0000" + a.charCodeAt(0).toString(16)).slice(-4)
                                                                                                                                                                                                                                                                                                                                        }) + '"' : '"' + string + '"'
                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                    function str(key, holder) {
                                                                                                                                                                                                                                                                                                                                        var i, k, v, length, mind = gap,
                                                                                                                                                                                                                                                                                                                                            partial, value = holder[key];
                                                                                                                                                                                                                                                                                                                                        if (value && typeof value === "object" && typeof value.toJSON === "function") {
                                                                                                                                                                                                                                                                                                                                            value = value.toJSON(key)
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        if (typeof rep === "function") {
                                                                                                                                                                                                                                                                                                                                            value = rep.call(holder, key, value)
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                        switch (typeof value) {
                                                                                                                                                                                                                                                                                                                                        case "string":
                                                                                                                                                                                                                                                                                                                                            return quote(value);
                                                                                                                                                                                                                                                                                                                                        case "number":
                                                                                                                                                                                                                                                                                                                                            return isFinite(value) ? String(value) : "null";
                                                                                                                                                                                                                                                                                                                                        case "boolean":
                                                                                                                                                                                                                                                                                                                                        case "null":
                                                                                                                                                                                                                                                                                                                                            return String(value);
                                                                                                                                                                                                                                                                                                                                        case "object":
                                                                                                                                                                                                                                                                                                                                            if (!value) {
                                                                                                                                                                                                                                                                                                                                                return "null"
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            gap += indent;
                                                                                                                                                                                                                                                                                                                                            partial = [];
                                                                                                                                                                                                                                                                                                                                            if (Object.prototype.toString.apply(value) === "[object Array]") {
                                                                                                                                                                                                                                                                                                                                                length = value.length;
                                                                                                                                                                                                                                                                                                                                                for (i = 0; i < length; i += 1) {
                                                                                                                                                                                                                                                                                                                                                    partial[i] = str(i, value) || "null"
                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                v = partial.length === 0 ? "[]" : gap ? "[\n" + gap + partial.join(",\n" + gap) + "\n" + mind + "]" : "[" + partial.join(",") + "]";
                                                                                                                                                                                                                                                                                                                                                gap = mind;
                                                                                                                                                                                                                                                                                                                                                return v
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            if (rep && typeof rep === "object") {
                                                                                                                                                                                                                                                                                                                                                length = rep.length;
                                                                                                                                                                                                                                                                                                                                                for (i = 0; i < length; i += 1) {
                                                                                                                                                                                                                                                                                                                                                    k = rep[i];
                                                                                                                                                                                                                                                                                                                                                    if (typeof k === "string") {
                                                                                                                                                                                                                                                                                                                                                        v = str(k, value);
                                                                                                                                                                                                                                                                                                                                                        if (v) {
                                                                                                                                                                                                                                                                                                                                                            partial.push(quote(k) + (gap ? ": " : ":") + v)
                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                            } else {
                                                                                                                                                                                                                                                                                                                                                for (k in value) {
                                                                                                                                                                                                                                                                                                                                                    if (Object.hasOwnProperty.call(value, k)) {
                                                                                                                                                                                                                                                                                                                                                        v = str(k, value);
                                                                                                                                                                                                                                                                                                                                                        if (v) {
                                                                                                                                                                                                                                                                                                                                                            partial.push(quote(k) + (gap ? ": " : ":") + v)
                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            v = partial.length === 0 ? "{}" : gap ? "{\n" + gap + partial.join(",\n" + gap) + "\n" + mind + "}" : "{" + partial.join(",") + "}";
                                                                                                                                                                                                                                                                                                                                            gap = mind;
                                                                                                                                                                                                                                                                                                                                            return v
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                    if (typeof JSON.stringify !== "function") {
                                                                                                                                                                                                                                                                                                                                        JSON.stringify = function (value, replacer, space) {
                                                                                                                                                                                                                                                                                                                                            var i;
                                                                                                                                                                                                                                                                                                                                            gap = "";
                                                                                                                                                                                                                                                                                                                                            indent = "";
                                                                                                                                                                                                                                                                                                                                            if (typeof space === "number") {
                                                                                                                                                                                                                                                                                                                                                for (i = 0; i < space; i += 1) {
                                                                                                                                                                                                                                                                                                                                                    indent += " "
                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                            } else {
                                                                                                                                                                                                                                                                                                                                                if (typeof space === "string") {
                                                                                                                                                                                                                                                                                                                                                    indent = space
                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            rep = replacer;
                                                                                                                                                                                                                                                                                                                                            if (replacer && typeof replacer !== "function" && (typeof replacer !== "object" || typeof replacer.length !== "number")) {
                                                                                                                                                                                                                                                                                                                                                throw new Error("JSON.stringify")
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            return str("", {
                                                                                                                                                                                                                                                                                                                                                "": value
                                                                                                                                                                                                                                                                                                                                            })
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                    if (typeof JSON.parse !== "function") {
                                                                                                                                                                                                                                                                                                                                        JSON.parse = function (text, reviver) {
                                                                                                                                                                                                                                                                                                                                            var j;

                                                                                                                                                                                                                                                                                                                                            function walk(holder, key) {
                                                                                                                                                                                                                                                                                                                                                var k, v, value = holder[key];
                                                                                                                                                                                                                                                                                                                                                if (value && typeof value === "object") {
                                                                                                                                                                                                                                                                                                                                                    for (k in value) {
                                                                                                                                                                                                                                                                                                                                                        if (Object.hasOwnProperty.call(value, k)) {
                                                                                                                                                                                                                                                                                                                                                            v = walk(value, k);
                                                                                                                                                                                                                                                                                                                                                            if (v !== undefined) {
                                                                                                                                                                                                                                                                                                                                                                value[k] = v
                                                                                                                                                                                                                                                                                                                                                            } else {
                                                                                                                                                                                                                                                                                                                                                                delete value[k]
                                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                return reviver.call(holder, key, value)
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            cx.lastIndex = 0;
                                                                                                                                                                                                                                                                                                                                            if (cx.test(text)) {
                                                                                                                                                                                                                                                                                                                                                text = text.replace(cx, function (a) {
                                                                                                                                                                                                                                                                                                                                                    return "\\u" + ("0000" + a.charCodeAt(0).toString(16)).slice(-4)
                                                                                                                                                                                                                                                                                                                                                })
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            if (/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g, "@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, "]").replace(/(?:^|:|,)(?:\s*\[)+/g, ""))) {
                                                                                                                                                                                                                                                                                                                                                j = eval("(" + text + ")");
                                                                                                                                                                                                                                                                                                                                                return typeof reviver === "function" ? walk({
                                                                                                                                                                                                                                                                                                                                                    "": j
                                                                                                                                                                                                                                                                                                                                                }, "") : j
                                                                                                                                                                                                                                                                                                                                            }
                                                                                                                                                                                                                                                                                                                                            throw new SyntaxError("JSON.parse")
                                                                                                                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                                                                                                                    }
                                                                                                                                                                                                                                                                                                                                }());
																																																																																